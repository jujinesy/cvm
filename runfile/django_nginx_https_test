upstream django {
	server unix:/home/ubuntu/cvm/runfile/uwsgi.sock;
}

#
# Redirect all www to non-www
#
server {
	server_name www.sh3ltr.org;
	ssl_certificate /etc/letsencrypt/live/sh3ltr.org/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/sh3ltr.org/privkey.pem;
	listen *:80;
	listen *:443 ssl spdy;
	listen [::]:80 ipv6only=on;
	listen [::]:443 ssl spdy ipv6only=on;

	return 301 https://sh3ltr.org$request_uri;
}

#
# Redirect all non-encrypted to encrypted
#
server {
	server_name	sh3ltr.org;
	listen	*:80;
	listen	[::]:80;

	return 301 https://sh3ltr.org$request_uri;
}

#
# There we go!
#
server {
	server_name sh3ltr.org;
	listen *:443 ssl spdy;
	listen [::]:443 ssl spdy;

	ssl on;
	ssl_certificate /etc/letsencrypt/live/sh3ltr.org/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/sh3ltr.org/privkey.pem;

	location = /favicon.ico {
		access_log off; log_not_found off;
	}

	client_max_body_size 200M;

	location /media  {
		alias /home/ubuntu/cvm/media;
	}

	location /static {
		alias /home/ubuntu/cvm/static;
	}

	location / {
		uwsgi_pass django;
		include /etc/nginx/uwsgi_params;
	}

	error_page 500 502 503 504 /custom_50x.html;
	location = /custom_50x.html {
		root /home/ubuntu/cvm/runfile/page;
		internal;
	}
}
